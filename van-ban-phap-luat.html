<!doctype html>
<html lang="vi">
  <head>

    <meta charset="utf-8">
    <title>Văn bản pháp luật</title>
    <meta name="description" content="Hệ thống văn bản về thuế mới nhất">
    <meta name="keywords" content="" />
    <meta name="robots" content="index,follow" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link href="css/style.css" rel="stylesheet">
    <link href="css/font.css" rel="stylesheet">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
  </head>
  <body>
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
          <a class="navbar-brand" href="index.html">appTax</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse  navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">Tính chậm nộp</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="van-ban-phap-luat.html">Văn bản pháp luật</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="noi-dung-kinh-te.html">Nội dung kinh tế (mục, tiểu mục)</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="danh-muc-chuong.html">Danh mục chương</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://facebook.com/suribeautyshop" target="_blank" rel="nofollow">Shop</a>
                </li>
            </ul>
          </div>
        </nav>
        <div class="row">
            <div class="col-sm-9">
              <div id="breadcrumb"></div>
              <div id="noi-dung">
                <p>Nhằm giúp người sử dụng thuận tiện trong việc cập nhật và áp dụng văn bản về pháp luật về thuế; appTax.net xin cập nhật Hệ thống các Luật, Nghị định, Thông tư, Văn bản hợp nhất về thuế đã hết hiệu lực, đang còn hiệu lực hoặc sắp có hiệu lực thi hành</p>
              </div>
            </div>
            <div class="col-sm-3">
              <div id="menu">
                <input id="txtSearchVb" class="form-control" type="text" placeholder="Tìm số văn bản" aria-label="Search">
              </div>
            </div>
        </div>
        <footer class="footer">
            <div>
                <ul class="list-inline">
                  <li class="list-inline-item"><a href="index.html">Trang chủ</a></li>
                  <li class="list-inline-item"><a href="https://lehoangdieu.blogspot.com/">Hướng dẫn khai nộp thuế</a></li>
                  <li class="list-inline-item"><a href="https://www.facebook.com/khainopthue">Fanpage</a></li>
                  <li class="list-inline-item"><a href="https://facebook.com/suribeautyshop" target="_blank" rel="nofollow">Shop của tui</a></li>
                  <li class="list-inline-item"><a href="http://tracuuhoadon.gdt.gov.vn" target="_blank" rel="nofollow">Tra cứu hóa đơn</a></li>
                </ul>
          </div>      
            <div class="text-muted">© Copyright 2020 <a href="mailto:lehoangdieu@gmail.com">lehoangdieu</a></div>
        </footer>
    </div>
    <script src="js/jquery-3.3.1.slim.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/lib.js"></script>
    <script type="text/javascript">
      function click_link(e)
      {
        var div = document.getElementById('noi-dung');
        var sorry = 'Rất tiếc văn bản này chưa được hệ thống cập nhật';
        var tmp, have_it;
        n = new Date();
        cur_year = n.getFullYear();
        var tit = 'Hệ thống văn bản về thuế mới nhất năm '+cur_year
        if (window.location.hash.trim() == ''){
            document.title = 'Hệ thống văn bản về thuế mới nhất năm '+cur_year;
            document.querySelector('meta[name="description"]').setAttribute("content", tit);
            document.getElementById('breadcrumb').textContent = '';
            var current_addr = window.location.href;
            if (current_addr.indexOf('#') >= 0)
              div.textContent = sorry;
            else
              div.innerHTML = '<p style="padding-top:1rem">Nhằm giúp người sử dụng thuận tiện trong việc cập nhật và áp dụng văn bản về pháp luật về thuế; appTax.net xin cập nhật Hệ thống các Luật, Nghị định, Thông tư, Văn bản hợp nhất về thuế đã hết hiệu lực, đang còn hiệu lực hoặc sắp có hiệu lực thi hành</p>';
        } else{
          var href_root = e.split('#');
          var href = href_root[1].split('/');
            if (href[1].trim() !== ''){
              load_json(function(res){
                var data_json = JSON.parse(res);
                var items = data_json['all'];
                have_it = false;
                for (var i=0; i<items.length; i++){
                  detail = items[i];
                  //if (items[i]['cata_id'] == href[0]){
                    //for (var j=0; j<detail.length; j++){
                      if (detail['id'] === href[1]){
                        have_it = true;
                        document.getElementById('breadcrumb').innerHTML = `<nav aria-label="breadcrumb">
                                                                              <ol class="breadcrumb">
                                                                                <li class="breadcrumb-item">${detail['loai_van_ban']} số ${detail['tieu_de']}</li>
                                                                              </ol>
                                                                            </nav>`;
                        var str = '';
                        document.title = detail['loai_van_ban']+' số '+detail['tieu_de'];
                        document.querySelector('meta[name="description"]').setAttribute('content', detail['mo_ta']);
                        if (detail['huong_dan_cho'].length > 0){
                          tmp = detail['huong_dan_cho'];
                          str += '<li>Hướng dẫn cho: ';
                          for (var k=0; k<tmp.length; k++){
                            str += `<a href="#apptax/${tmp[k]['id']}">${tmp[k]['ten']}</a>, `;
                          }
                          str = str.replace(/, $/g, "");
                          str += '</li>';
                        }

                        if (detail['sua_doi_cho'].length > 0){
                          var sua_doi_cho = detail['sua_doi_cho'];
                          str += '<li>Sửa đổi cho: ';
                          for (var k=0; k<sua_doi_cho.length; k++){
                            str += `<a href="#apptax/${sua_doi_cho[k]['id']}">${sua_doi_cho[k]['ten']}</a>, `;
                          }
                          str = str.replace(/, $/g, "");
                          str += '</li>';
                        }
                        if (detail['thay_the_cho'].length > 0){
                          var thay_the_cho = detail['thay_the_cho'];
                          str += '<li>Thay thế cho: ';
                          for (var k=0; k<thay_the_cho.length; k++){
                            str += `<a href="#apptax/${thay_the_cho[k]['id']}">${thay_the_cho[k]['ten']}</a>, `;
                          }
                          str = str.replace(/, $/g, "");
                          str += '</li>';
                        }
                        if (detail['hop_nhat_cho'].length > 0){
                          tmp = detail['hop_nhat_cho'];
                          str += '<li>Hợp nhất cho: ';
                          for (var k=0; k<tmp.length; k++){
                            str += `<a href="#apptax/${tmp[k]['id']}">${tmp[k]['ten']}</a>, `;
                          }
                          str = str.replace(/, $/g, "");
                          str += '</li>';
                        }

                        if (detail['huong_dan_boi'].length > 0){
                          tmp = detail['huong_dan_boi'];
                          str += '<li>Đã có văn bản hướng dẫn: ';
                          for (var k=0; k<tmp.length; k++){
                            str += `<a href="#apptax/${tmp[k]['id']}">${tmp[k]['ten']}</a>, `;
                          }
                          str = str.replace(/, $/g, "");
                          str += '</li>';
                        }
                        if (detail['bi_sua_boi'].length > 0){
                          var bi_sua_boi = detail['bi_sua_boi'];
                          str += '<li>Bị sửa bởi: ';
                          for (var k=0; k<bi_sua_boi.length; k++){
                            str += `<a href="#apptax/${bi_sua_boi[k]['id']}">${bi_sua_boi[k]['ten']}</a>, `;
                          }
                          str = str.replace(/, $/g, "");
                          str += '</li>';
                        }
                        if (detail['bi_thay_boi'].length > 0){
                          var bi_thay_boi = detail['bi_thay_boi'];
                          str += '<li>Bị thay bởi: ';
                          for (var k=0; k<bi_thay_boi.length; k++){
                            str += `<a href="#apptax/${bi_thay_boi[k]['id']}">${bi_thay_boi[k]['ten']}</a>, `;
                          }
                          str = str.replace(/, $/g, "");
                          str += '</li>';
                        }
                        if (detail['hop_nhat_boi'].length > 0){
                          tmp = detail['hop_nhat_boi'];
                          str += '<li>Hợp nhất bởi: ';
                          for (var k=0; k<tmp.length; k++){
                            str += `<a href="#apptax/${tmp[k]['id']}">${tmp[k]['ten']}</a>, `;
                          }
                          str = str.replace(/, $/g, "");
                          str += '</li>';
                        }

                        if (detail['ngay_ban_hanh'].trim() !== ''){
                          str += `<li>Ngày ban hành: ${detail['ngay_ban_hanh']}</li>`;
                        }
                        if (detail['ngay_hieu_luc'].trim() !== ''){
                          str += `<li>Ngày hiệu lực: ${detail['ngay_hieu_luc']}</li>`;
                        }

                        if (detail['ngay_het_han'].trim() !== ''){
                          str += `<li><span class="badge badge-danger">Ngày hết hiệu lực: ${detail['ngay_het_han']}</span></li>`;
                        }
                        if (detail['download'].length > 0){
                          tmp = detail['download'];
                          str += '<li>Download: ';
                          for (var k=0; k<tmp.length; k++){
                            str += `<a href="download/${tmp[k]['path']}">${tmp[k]['desc']}</a>, `;
                          }
                          str = str.replace(/, $/g, "");
                          str += '</li>';
                        }

                        if (str !== ''){
                          str = '<ul class="list-unstyled">'+str+'</ul>';
                        }
                        div.innerHTML = str;

                        if (detail['url'].trim() !== ''){
                          if (detail['file_type'] === 'doc'){
                            var iframe = document.createElement('iframe');
                            iframe.setAttribute('id','my-iframe');
                            iframe.setAttribute('scrolling','no');
                            iframe.setAttribute('width','100%');
                            iframe.setAttribute('src',`vb/${detail['url']}.htm`);
                            div.appendChild(iframe);
                              window.addEventListener('message', function(e){
                                // message passed can be accessed in "data" attribute of the event object
                                var scroll_height = e.data;
                                document.getElementById('my-iframe').style.height = scroll_height + 'px'; 
                              }, false);
                          } else if (detail['file_type'] === 'ard'){
                            var obj = document.createElement('iframe');
                            obj.setAttribute('src',`vb/${detail['url']}.pdf`);
                            obj.setAttribute('width','100%');
                            obj.setAttribute('height','800px');
                            obj.setAttribute('frameborder','0');
                            div.appendChild(obj);
                          }
                          window.history.pushState({}, document.title, e);
                        } else{
                          document.title = 'Hệ thống văn bản về thuế mới nhất năm '+cur_year;
                          document.querySelector('meta[name="description"]').setAttribute("content", tit);
                          document.getElementById('breadcrumb').textContent = '';
                          div.innerHTML += '<p>'+sorry+'</p>';
                        }

                        break;
                      }
                    //}
                  //}
                } //end for
                if (!have_it){ //neu ko co id
                  document.title = 'Hệ thống văn bản về thuế mới nhất năm '+cur_year;
                  document.querySelector('meta[name="description"]').setAttribute("content", tit);
                  document.getElementById('breadcrumb').textContent = '';
                  div.innerHTML = '<p>'+sorry+'</p>';
                }
              }); //end callback load_json
              //console.log(have_it);
              
            } else{
              document.getElementById('breadcrumb').textContent = '';
              div.textContent = sorry;
            }
        }
        var top = document.getElementById("breadcrumb");
        top.scrollIntoView({behavior: "smooth"}); //scroll to top
      }
      function load_json(callback)
      {
        var xobj = new XMLHttpRequest();
        xobj.overrideMimeType("application/json");
        xobj.open('GET', 'catalogue/vbpl.json', true);
        xobj.onreadystatechange = function (){
          if (xobj.readyState == 4 && xobj.status == "200"){
            // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
            callback(xobj.responseText);
          }
        };
        xobj.setRequestHeader('cache-control', 'no-cache, must-revalidate, post-check=0, pre-check=0');
        xobj.send(null);
      }
      function init()
      {
        load_json(function(response){
          // Parse JSON string into object
          var data_json = JSON.parse(response);
          var items = data_json['dmuc'];
          var vb = data_json['all'];
          var menu = document.getElementById('menu');
          var div, ul, li, a, cata, detail, badge, is_outdate, tag;
          var tbl = '<table class="table table-striped table-hover table-sm table-responsive-sm font-very-small"><thead><tr><th scope="col">Nội dung</th><th scope="col">Loại VB</th><th scope="col">Số hiệu</th><th scope="col">Ngày hiệu lực</th><th scope="col">Đã bị sửa/bị thay/có hợp nhất</th><th scope="col">Ngày hết hiệu lực</th></tr></thead>';
          for (var i=0; i<items.length; i++){
            // create a new div and set its attributes
            div = document.createElement('div');
            div.setAttribute('class','cata-menu');
            cata = document.createElement('a');
            cata.setAttribute('id','no'+i);
            cata.setAttribute('href','javascript:void(0)');
            cata.setAttribute('onclick','click_cata(this)');
            cata.textContent = items[i]['ten'];
            div.appendChild(cata);
            //add sub
            ul = document.createElement('ul');
            ul.setAttribute('id','sub-no'+i);
            ul.setAttribute('class','list-group list-group-flush');
            ul.setAttribute('style','display: none;');
            for (var j = 0; j<vb.length; j++){
              tag = vb[j]['tag'];
              if (tag.includes(parseInt(items[i]['id']))){
                tbl += `<tr><td>${items[i]['ten']}</td>`;
                li = document.createElement('li');
                li.setAttribute('class','list-group-item');
                a = document.createElement('a');
                a.setAttribute('class','link-vb');
                a.setAttribute('href',`#${i}/${vb[j]['id']}`);
                a.setAttribute('data-toggle','tooltip');
                a.setAttribute('data-placement','left');
                a.setAttribute('title',vb[j]['mo_ta']);
                a.textContent = vb[j]['loai_van_ban']+' số '+vb[j]['tieu_de'];
                li.appendChild(a);
                tbl += `<td>${vb[j]['loai_van_ban']}</td><td><a href="van-ban-phap-luat.html#${i}/${vb[j]['id']}">${vb[j]['tieu_de']}</a></td><td>${vb[j]['ngay_hieu_luc']}</td>`;

                //add badge neu co canh bao
                td_het_han = `<td></td>`;
                is_outdate = false;
                if (vb[j]['ngay_het_han'] !== ''){
                  if (date_greater_than_date(current_date(),vb[j]['ngay_het_han'])){
                    badge = document.createElement('span');
                    badge.setAttribute('class','badge badge-danger badge-small');
                    badge.textContent = 'Hết h.lực';
                    is_outdate = true;
                    li.appendChild(badge);
                  }
                  td_het_han = `<td>${vb[j]['ngay_het_han']}</td>`;
                  //tbl += `<td></td><td>${vb[j]['ngay_het_han']}</td></tr>`;
                }
                td_str = '';
                if (!is_outdate){
                  //neu van chua han hieu luc
                  if (vb[j]['bi_sua_boi'].length > 0){
                    badge = document.createElement('span');
                    badge.setAttribute('class','badge badge-warning badge-small');
                    badge.textContent = 'Đã bị sửa';
                    li.appendChild(badge);
                    td_str += ', Đã bị sửa';
                  }
                }
                if (!is_outdate){
                  //neu van chua han hieu luc
                  if (vb[j]['bi_thay_boi'].length > 0){
                    badge = document.createElement('span');
                    badge.setAttribute('class','badge badge-warning badge-small');
                    badge.textContent = 'Đã bị thay';
                    li.appendChild(badge);
                    td_str += ', Đã bị thay';
                    //tbl += `<td>Đã bị thay</td><td></td></tr>`;
                  }
                }
                if (!is_outdate){
                  //neu van chua han hieu luc
                  if (vb[j]['hop_nhat_boi'].length > 0){
                    badge = document.createElement('span');
                    badge.setAttribute('class','badge badge-warning badge-small');
                    badge.textContent = 'Có hợp nhất';
                    li.appendChild(badge);
                    td_str += ', Đã có hợp nhất';
                    //tbl += `<td>Đã có hợp nhất</td><td></td></tr>`;
                  }
                }

                ul.appendChild(li);
                td_str = td_str.replace(/^, /g, "");
                tbl += '<td>'+td_str+'</td>' + td_het_han +'</tr>';
              }
            }
            menu.appendChild(div);
            menu.appendChild(ul);
          }
          tbl += '</table>';
          if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){
            
          }else{
            document.getElementById('noi-dung').innerHTML += tbl;
          }
          

        });
      }
      function click_cata(e)
      {
        var id = e.getAttribute('id');
        var sub_cata = document.getElementById('sub-'+id);
        //console.log(sub_cata.getAttribute('style'));
        if (sub_cata.getAttribute('style').trim() === 'display: none;'){
          sub_cata.setAttribute('style','display: block;');
        } else{
          sub_cata.setAttribute('style','display: none;');
        }
      }
      function findByTextContent(needle, haystack, precise) {
        // needle: String, the string to be found within the elements.
        // haystack: String, a selector to be passed to document.querySelectorAll(),
        //           NodeList, Array - to be iterated over within the function:
        // precise: Boolean, true - searches for that precise string, surrounded by
        //                          word-breaks,
        //                   false - searches for the string occurring anywhere
        var elems;

        // no haystack we quit here, to avoid having to search
        // the entire document:
        if (!haystack) {
          return false;
        }
        // if haystack is a string, we pass it to document.querySelectorAll(),
        // and turn the results into an Array:
        else if ('string' == typeof haystack) {
          elems = [].slice.call(document.querySelectorAll(haystack), 0);
        }
        // if haystack has a length property, we convert it to an Array
        // (if it's already an array, this is pointless, but not harmful):
        else if (haystack.length) {
          elems = [].slice.call(haystack, 0);
        }

        // work out whether we're looking at innerText (IE), or textContent 
        // (in most other browsers)
        var textProp = 'textContent' in document ? 'textContent' : 'innerText',
          // creating a regex depending on whether we want a precise match, or not:
          reg = precise === true ? new RegExp('\\b' + needle + '\\b') : new RegExp(needle),
          // iterating over the elems array:
          found = elems.filter(function(el) {
            // returning the elements in which the text is, or includes,
            // the needle to be found:
            return reg.test(el[textProp]);
          });
        return found.length ? found : false;;
      }
      function load_data()
      {
        addr = window.location.hash.trim();
        click_link(addr);
      }
      document.addEventListener('DOMContentLoaded', function(){
        init();
        load_data();
        window.addEventListener('hashchange',load_data,false);
        document.getElementById('txtSearchVb').addEventListener('change',function(){
          var txt = document.getElementById('txtSearchVb')
          if (txt.value.trim() !== ''){
            document.querySelectorAll('.list-group').forEach(function(elem){
              elem.style.display = 'block';
            });
            document.querySelectorAll('.link-vb').forEach(function(elem){
              elem.parentNode.style.display = 'none';
            });
            findByTextContent(txt.value, '.link-vb').forEach(function(elem){
              elem.parentNode.style.display = '';
            });
          } else{
            document.querySelectorAll('.list-group').forEach(function(elem){
              elem.style.display = 'none';
            });
            document.querySelectorAll('.link-vb').forEach(function(elem){
              elem.parentNode.style.display = 'block';
            });
          }
        });

      })
      $("body").tooltip({ selector:'[data-toggle=tooltip]'});
    </script>
  </body>
</html>